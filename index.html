<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr. S. Alwyn Rajiv â€” Faculty Timetable</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT VARIABLES â€” LIGHT & DARK THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:         #eef2ff;
  --bg2:        #e0e7ff;
  --white:      #ffffff;
  --card:       #ffffff;
  --surf:       #f5f7ff;
  --border:     #dce3f5;
  --border2:    #c7d2ec;
  --text:       #0f172a;
  --text2:      #334155;
  --muted:      #64748b;
  --blue:       #2563eb;
  --blue-d:     #1d4ed8;
  --blue-lt:    #dbeafe;
  --green:      #059669;
  --green-lt:   #d1fae5;
  --rose:       #e11d48;
  --rose-lt:    #ffe4e6;
  --amber:      #d97706;
  --amber-lt:   #fef3c7;
  --head-from:  #1e3a8a;
  --head-to:    #2563eb;
  --head-text:  #bfdbfe;
  --head-muted: #93c5fd;
  --row-even:   #f8faff;
  --row-hover:  #eff6ff;
  --break-line: #bfdbfe;
  --sh-sm:      0 1px 4px rgba(30,50,120,0.07);
  --sh:         0 4px 20px rgba(30,50,120,0.10);
  --sh-lg:      0 12px 40px rgba(30,50,120,0.13);
  --sh-xl:      0 24px 60px rgba(30,50,120,0.18);
  --radius:     20px;
}

[data-theme="dark"] {
  --bg:         #0f172a;
  --bg2:        #1e293b;
  --white:      #1e293b;
  --card:       #1e293b;
  --surf:       #0f172a;
  --border:     #334155;
  --border2:    #475569;
  --text:       #f1f5f9;
  --text2:      #cbd5e1;
  --muted:      #64748b;
  --blue:       #60a5fa;
  --blue-d:     #93c5fd;
  --blue-lt:    #1e3a5f;
  --green:      #34d399;
  --green-lt:   #064e3b;
  --rose:       #fb7185;
  --rose-lt:    #4c0519;
  --amber:      #fbbf24;
  --amber-lt:   #451a03;
  --head-from:  #0f172a;
  --head-to:    #1e3a8a;
  --head-text:  #93c5fd;
  --head-muted: #60a5fa;
  --row-even:   #162032;
  --row-hover:  #1e3a5f;
  --break-line: #334155;
  --sh-sm:      0 1px 4px rgba(0,0,0,0.3);
  --sh:         0 4px 20px rgba(0,0,0,0.4);
  --sh-lg:      0 12px 40px rgba(0,0,0,0.5);
  --sh-xl:      0 24px 60px rgba(0,0,0,0.6);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{
  background:var(--bg);
  color:var(--text);
  font-family:'DM Sans',sans-serif;
  min-height:100vh;
  padding:0 0 80px;
  overflow-x:hidden;
  transition:background .3s,color .3s;
}

/* Decorative blobs */
.blob{position:fixed;border-radius:50%;filter:blur(90px);pointer-events:none;z-index:0;transition:opacity .3s}
.blob-1{width:600px;height:600px;background:radial-gradient(circle,#bfdbfe88,transparent 65%);top:-180px;left:-180px;opacity:.7}
.blob-2{width:500px;height:500px;background:radial-gradient(circle,#e0e7ff88,transparent 65%);bottom:-120px;right:-120px;opacity:.7}
.blob-3{width:300px;height:300px;background:radial-gradient(circle,#c7d2ec55,transparent 65%);top:40%;left:60%;opacity:.4}
[data-theme="dark"] .blob-1{background:radial-gradient(circle,#1e3a8a55,transparent 65%)}
[data-theme="dark"] .blob-2{background:radial-gradient(circle,#312e8155,transparent 65%)}
[data-theme="dark"] .blob-3{background:radial-gradient(circle,#0f172a55,transparent 65%)}

.page-wrap{position:relative;z-index:1;max-width:1420px;margin:0 auto;padding:0 22px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOP BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.top-banner{
  background:linear-gradient(135deg,var(--head-from) 0%,#1e40af 50%,var(--head-to) 100%);
  padding:28px 22px 22px;
  margin-bottom:28px;
  position:relative;
  overflow:hidden;
}
.top-banner::before{
  content:'';position:absolute;inset:0;
  background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}
.banner-inner{max-width:1420px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:20px;flex-wrap:wrap;position:relative;z-index:1}
.banner-left{display:flex;align-items:center;gap:18px}
.avatar{
  width:62px;height:62px;border-radius:18px;flex-shrink:0;
  background:linear-gradient(135deg,#60a5fa,#818cf8);
  display:flex;align-items:center;justify-content:center;
  font-family:'Playfair Display',serif;font-size:1.7rem;color:#fff;
  box-shadow:0 8px 24px rgba(0,0,0,0.3);
  border:2px solid rgba(255,255,255,0.2);
}
.prof-name{font-family:'Playfair Display',serif;font-size:clamp(1.4rem,3vw,2rem);font-weight:900;color:#fff;letter-spacing:-.5px;line-height:1.1;text-shadow:0 2px 8px rgba(0,0,0,0.2)}
.prof-sub{font-size:0.76rem;color:#93c5fd;margin-top:5px;font-weight:500;letter-spacing:.5px}
.banner-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

/* Stats pills in banner */
.stat-pill{
  display:flex;align-items:center;gap:6px;
  background:rgba(255,255,255,0.1);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:50px;padding:7px 14px;
  font-family:'DM Mono',monospace;font-size:0.7rem;color:#bfdbfe;font-weight:500;
  backdrop-filter:blur(4px);
}
.stat-pill strong{color:#fff;font-size:.8rem}

.day-badge{
  display:flex;align-items:center;gap:8px;
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:50px;padding:8px 18px;
  font-family:'DM Mono',monospace;font-size:0.72rem;color:#dbeafe;font-weight:500;
  backdrop-filter:blur(4px);
}
.pulse{width:8px;height:8px;background:#34d399;border-radius:50%;animation:pulse 2s ease-in-out infinite;flex-shrink:0}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(52,211,153,.6)}50%{box-shadow:0 0 0 6px rgba(52,211,153,0)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toolbar{
  display:flex;align-items:center;gap:8px;margin-bottom:20px;flex-wrap:wrap;
  background:var(--card);border:1.5px solid var(--border);border-radius:14px;
  padding:12px 16px;box-shadow:var(--sh-sm);
}
.toolbar-group{display:flex;align-items:center;gap:6px}
.toolbar-sep{width:1px;height:28px;background:var(--border);margin:0 6px}

.btn{
  font-family:'DM Sans',sans-serif;font-size:0.78rem;font-weight:600;
  padding:8px 14px;border-radius:9px;border:1.5px solid transparent;
  cursor:pointer;transition:all .18s;display:inline-flex;align-items:center;gap:5px;white-space:nowrap;
}
.btn-primary{background:var(--blue);color:#fff;border-color:var(--blue);box-shadow:0 4px 12px rgba(37,99,235,.25)}
.btn-primary:hover{background:var(--blue-d);transform:translateY(-1px);box-shadow:0 6px 18px rgba(37,99,235,.35)}
.btn-outline{background:var(--white);color:var(--text2);border-color:var(--border2);box-shadow:var(--sh-sm)}
.btn-outline:hover{border-color:var(--blue);color:var(--blue);transform:translateY(-1px)}
.btn-danger{background:var(--white);color:var(--rose);border-color:var(--rose-lt)}
.btn-danger:hover{background:var(--rose-lt);transform:translateY(-1px)}
.btn-success{background:var(--green);color:#fff;border-color:var(--green);box-shadow:0 4px 12px rgba(5,150,105,.25)}
.btn-success:hover{background:#047857;transform:translateY(-1px)}
.btn-amber{background:var(--amber);color:#fff;border-color:var(--amber);box-shadow:0 4px 12px rgba(217,119,6,.25)}
.btn-amber:hover{background:#b45309;transform:translateY(-1px)}
.btn-icon{padding:8px;border-radius:9px;background:var(--white);border:1.5px solid var(--border2);color:var(--text2);cursor:pointer;transition:all .18s;display:inline-flex;align-items:center;justify-content:center;font-size:1rem}
.btn-icon:hover{border-color:var(--blue);color:var(--blue);transform:translateY(-1px)}
.btn-icon.active{background:var(--blue);color:#fff;border-color:var(--blue)}

/* Search */
.search-wrap{position:relative;margin-left:auto}
.search-input{
  background:var(--surf);border:1.5px solid var(--border);border-radius:9px;
  padding:8px 12px 8px 34px;font-family:'DM Sans',sans-serif;font-size:0.78rem;
  color:var(--text);outline:none;width:200px;transition:all .2s;
}
.search-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1);width:240px}
.search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:.9rem;pointer-events:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.table-wrapper{
  background:var(--card);border-radius:var(--radius);
  border:1.5px solid var(--border);box-shadow:var(--sh-lg);
  overflow:hidden;overflow-x:auto;
  animation:fadeUp .4s ease both;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

table{width:100%;border-collapse:collapse;min-width:980px}

thead tr:first-child th{
  background:linear-gradient(180deg,var(--head-from) 0%,#1e40af 100%);
  padding:14px 10px;font-family:'DM Mono',monospace;font-size:.8rem;
  font-weight:500;color:var(--head-text);text-align:center;letter-spacing:1.5px;
}
thead tr:first-child th:first-child{
  color:var(--head-muted);font-size:.68rem;
  background:linear-gradient(180deg,#0f1f50,#1e3a8a);min-width:86px;
}
thead tr:last-child th{
  background:#eff6ff;padding:8px 7px;
  font-family:'DM Mono',monospace;font-size:.58rem;color:var(--blue);
  border-bottom:2px solid var(--break-line);text-align:center;white-space:nowrap;font-weight:500;
}
[data-theme="dark"] thead tr:last-child th{background:#162032;color:var(--head-muted)}
thead tr:last-child th:first-child{background:#dbeafe}
[data-theme="dark"] thead tr:last-child th:first-child{background:#0f1f50}

tbody tr td:first-child{
  background:linear-gradient(180deg,#f0f7ff,#e8f0fe);
  font-family:'DM Mono',monospace;font-size:.7rem;font-weight:600;
  color:var(--blue);text-align:center;padding:10px 8px;letter-spacing:1px;
  border-right:2px solid var(--break-line);white-space:nowrap;min-width:86px;
}
[data-theme="dark"] tbody tr td:first-child{background:linear-gradient(180deg,#0f1f50,#162032)}

tbody tr td{border:1px solid var(--border);text-align:center;vertical-align:middle;padding:0;min-width:98px;transition:background .15s}
tbody tr:nth-child(even) td:not(:first-child):not(.break-col){background:var(--row-even)}
tbody tr:hover td:not(:first-child):not(.break-col){background:var(--row-hover)}

/* Today row highlight */
tbody tr.today-row td:first-child{
  background:linear-gradient(180deg,#1e40af,#2563eb) !important;
  color:#fff !important;
  position:relative;
}
tbody tr.today-row td:first-child::after{
  content:'TODAY';font-size:.42rem;display:block;letter-spacing:1px;color:#bfdbfe;margin-top:2px;
}

.cell-inner{
  padding:7px 5px;min-height:74px;display:flex;flex-direction:column;
  align-items:center;justify-content:center;gap:3px;transition:all .15s;position:relative;
}
.cell-inner.edit-mode{cursor:pointer}
.cell-inner.edit-mode:hover{background:rgba(37,99,235,.06);box-shadow:inset 0 0 0 2px var(--blue)}
.cell-inner.edit-mode:hover::after{
  content:'âœï¸';position:absolute;top:4px;right:4px;font-size:.65rem;opacity:.6;
}
.cell-inner.highlight{animation:hlFlash .5s ease}
@keyframes hlFlash{0%,100%{background:transparent}50%{background:rgba(251,191,36,.2)}}

.subject-pill{
  display:inline-flex;flex-direction:column;align-items:center;gap:2px;
  border-radius:10px;padding:5px 9px;width:100%;
  transition:transform .15s,box-shadow .15s;
}
.subject-pill:hover{transform:scale(1.04);box-shadow:0 4px 12px rgba(0,0,0,.1)}
.subject-code{font-family:'DM Mono',monospace;font-size:.76rem;font-weight:500;line-height:1.2}
.section-label{font-size:.58rem;font-weight:600;opacity:.8;letter-spacing:.3px;line-height:1.3;text-align:center}
.empty-dot{width:5px;height:5px;border-radius:50%;background:var(--border2);opacity:.5}

/* Break columns */
.break-col{
  background:repeating-linear-gradient(-45deg,transparent,transparent 6px,rgba(37,99,235,.025) 6px,rgba(37,99,235,.025) 12px) !important;
  border-left:2px dashed var(--break-line) !important;
  border-right:2px dashed var(--break-line) !important;
  min-width:40px !important;cursor:default !important;
}
.break-label{
  writing-mode:vertical-rl;text-orientation:mixed;font-family:'DM Mono',monospace;
  font-size:.52rem;letter-spacing:3px;color:var(--blue);text-transform:uppercase;
  font-weight:500;opacity:.45;padding:10px 4px;user-select:none;
}

/* Search highlight */
.cell-inner.search-hl .subject-pill{box-shadow:inset 0 0 0 2px var(--amber);animation:searchPop .3s ease}
@keyframes searchPop{0%{transform:scale(.95)}100%{transform:scale(1)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION CARDS BELOW TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cards-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:20px}
@media(max-width:900px){.cards-row{grid-template-columns:1fr}}

.card{
  background:var(--card);border:1.5px solid var(--border);border-radius:18px;
  padding:22px 24px;box-shadow:var(--sh-sm);animation:fadeUp .5s ease both;
}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.card-title{font-family:'Playfair Display',serif;font-size:1rem;font-weight:700;color:var(--text);display:flex;align-items:center;gap:8px}

/* Stats card */
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.stat-box{background:var(--surf);border:1.5px solid var(--border);border-radius:12px;padding:14px 12px;text-align:center}
.stat-num{font-family:'DM Mono',monospace;font-size:1.6rem;font-weight:500;color:var(--blue);line-height:1}
.stat-lbl{font-size:.65rem;color:var(--muted);font-weight:600;margin-top:4px;text-transform:uppercase;letter-spacing:.5px}

/* Legend */
.legend-grid{display:flex;flex-wrap:wrap;gap:8px}
.legend-item{
  display:flex;align-items:center;gap:6px;background:var(--surf);
  border:1.5px solid var(--border);border-radius:9px;padding:6px 11px;
  font-size:.75rem;color:var(--text2);font-weight:500;transition:all .15s;
}
.legend-item:hover{border-color:var(--blue);background:var(--blue-lt);transform:translateY(-1px)}
.legend-dot{width:10px;height:10px;border-radius:3px;flex-shrink:0}
.legend-code{font-family:'DM Mono',monospace;font-size:.72rem;font-weight:500}
.legend-desc{color:var(--muted);font-size:.69rem}

/* Period list */
.period-list{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px}
.period-tag{
  display:flex;align-items:center;gap:7px;background:var(--surf);
  border:1.5px solid var(--border);border-radius:9px;padding:6px 11px;
  font-family:'DM Mono',monospace;font-size:.72rem;color:var(--text2);
}
.period-tag-num{background:var(--blue);color:#fff;border-radius:5px;padding:2px 6px;font-size:.66rem;font-weight:600}
.period-tag-del{background:none;border:none;color:var(--rose);cursor:pointer;font-size:.8rem;font-weight:700;opacity:.45;transition:opacity .15s;padding:0 1px;line-height:1}
.period-tag-del:hover{opacity:1}

.add-form{display:flex;gap:9px;flex-wrap:wrap;align-items:flex-end;background:var(--surf);border:1.5px solid var(--border);border-radius:12px;padding:14px}
.ff{display:flex;flex-direction:column;gap:4px;flex:1;min-width:110px}
.ff label{font-size:.65rem;font-weight:700;color:var(--text2);letter-spacing:.5px;text-transform:uppercase}
.ff input,.ff select{background:var(--white);border:1.5px solid var(--border2);border-radius:8px;padding:8px 10px;color:var(--text);font-family:'DM Mono',monospace;font-size:.78rem;outline:none;transition:border-color .15s;width:100%}
.ff input:focus,.ff select:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION DIVIDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-div{display:flex;align-items:center;gap:12px;margin:22px 0 14px;color:var(--muted);font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1.2px}
.sec-div::before,.sec-div::after{content:'';flex:1;height:1px;background:var(--border)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{display:none;position:fixed;inset:0;background:rgba(15,30,80,.35);backdrop-filter:blur(10px);z-index:1000;align-items:center;justify-content:center;padding:20px}
.overlay.active{display:flex}
.modal{
  background:var(--card);border:1.5px solid var(--border);border-radius:22px;
  padding:28px 30px;width:490px;max-width:100%;
  box-shadow:var(--sh-xl);animation:modalIn .28s cubic-bezier(.34,1.56,.64,1);
  max-height:90vh;overflow-y:auto;
}
@keyframes modalIn{from{opacity:0;transform:scale(.88) translateY(24px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.modal-title{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;color:var(--text)}
.modal-close{background:var(--surf);border:none;border-radius:8px;width:32px;height:32px;font-size:1rem;cursor:pointer;color:var(--muted);display:flex;align-items:center;justify-content:center;transition:all .15s}
.modal-close:hover{background:var(--rose-lt);color:var(--rose)}
.modal-sub{font-size:.72rem;color:var(--muted);margin-bottom:20px;font-family:'DM Mono',monospace}
.mfg{margin-bottom:13px}
.mfg label{display:block;font-size:.68rem;font-weight:700;color:var(--text2);margin-bottom:5px;letter-spacing:.5px;text-transform:uppercase}
.mfg input,.mfg select{width:100%;background:var(--surf);border:1.5px solid var(--border2);border-radius:9px;padding:9px 13px;color:var(--text);font-family:'DM Mono',monospace;font-size:.82rem;outline:none;transition:border-color .15s}
.mfg input:focus,.mfg select:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.color-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:7px;margin-top:7px}
.cc{aspect-ratio:1;border-radius:8px;cursor:pointer;border:2.5px solid transparent;transition:all .15s;position:relative}
.cc:hover{transform:scale(1.12)}
.cc.on{border-color:var(--text);transform:scale(1.15);box-shadow:0 2px 10px rgba(0,0,0,.2)}
.cc.on::after{content:'âœ“';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:var(--text);text-shadow:0 1px 2px rgba(255,255,255,.5)}
.modal-acts{display:flex;gap:8px;margin-top:20px}
.modal-acts .btn{flex:1;justify-content:center}

/* Legend edit row */
.leg-row{display:flex;align-items:center;gap:7px;background:var(--surf);border:1.5px solid var(--border);border-radius:9px;padding:8px 11px}
.li{background:var(--white);border:1.5px solid var(--border2);border-radius:7px;padding:5px 8px;font-family:'DM Mono',monospace;font-size:.74rem;outline:none;color:var(--text);transition:border-color .15s}
.li:focus{border-color:var(--blue)}
.ls{background:var(--white);border:1.5px solid var(--border2);border-radius:7px;padding:5px 7px;font-size:.72rem;outline:none;color:var(--text);font-family:'DM Mono',monospace;cursor:pointer}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
  position:fixed;bottom:24px;right:24px;
  background:var(--card);border-radius:12px;
  padding:11px 18px;font-size:.78rem;font-weight:600;
  z-index:2000;transform:translateY(80px);opacity:0;
  transition:all .3s cubic-bezier(.34,1.56,.64,1);
  box-shadow:var(--sh-lg);display:flex;align-items:center;gap:8px;
  max-width:300px;
}
.toast.show{transform:translateY(0);opacity:1}
.toast.ok{border:1.5px solid var(--green);color:var(--green)}
.toast.err{border:1.5px solid var(--rose);color:var(--rose)}
.toast.info{border:1.5px solid var(--blue);color:var(--blue)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UNSAVED INDICATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.save-indicator{
  display:none;align-items:center;gap:5px;font-size:.7rem;color:var(--amber);
  font-weight:600;font-family:'DM Mono',monospace;
}
.save-indicator.show{display:flex}
.save-dot{width:6px;height:6px;background:var(--amber);border-radius:50%;animation:pulse 1.5s ease-in-out infinite}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT STYLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media print{
  .blob,.toolbar,.cards-row,.sec-div,.top-banner .banner-right{display:none !important}
  body{padding:0;background:#fff}
  .top-banner{padding:16px;-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .table-wrapper{box-shadow:none;border-radius:0;border:1px solid #ddd}
  .cell-inner.edit-mode:hover{background:transparent;box-shadow:none}
  .page-wrap{padding:0}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:10px}
::-webkit-scrollbar-thumb:hover{background:var(--muted)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:640px){
  .banner-right{gap:6px}
  .stat-pill{display:none}
  .toolbar{padding:10px 12px}
  .search-input{width:140px}
  .search-input:focus{width:160px}
}
</style>
</head>
<body>

<!-- Decorative blobs -->
<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â• TOP BANNER â•â•â•â•â•â•â•â•â•â•â• -->
<div class="top-banner">
  <div class="banner-inner">
    <div class="banner-left">
      <div class="avatar">A</div>
      <div>
        <div class="prof-name">Mr. S. Alwyn Rajiv</div>
        <div class="prof-sub">Department of Electronics &amp; Communication Engineering</div>
      </div>
    </div>
    <div class="banner-right">
      <div class="stat-pill"><strong id="statSlots">0</strong>&nbsp;Classes / Week</div>
      <div class="stat-pill"><strong id="statSubjects">0</strong>&nbsp;Subjects</div>
      <div class="day-badge"><div class="pulse"></div><span id="dayBadge">Loadingâ€¦</span></div>
    </div>
  </div>
</div>

<div class="page-wrap">

<!-- â•â•â•â•â•â•â•â•â•â•â• TOOLBAR â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toolbar">
  <div class="toolbar-group">
    <button class="btn btn-primary" id="editBtn" onclick="toggleEdit()">âœï¸ Enable Editing</button>
    <div class="save-indicator" id="saveInd"><div class="save-dot"></div> Unsaved</div>
  </div>
  <div class="toolbar-sep"></div>
  <div class="toolbar-group">
    <button class="btn btn-outline" onclick="exportData()" title="Export JSON">â¬‡ Export</button>
    <button class="btn btn-outline" onclick="document.getElementById('impFile').click()" title="Import JSON">â¬† Import</button>
    <input type="file" id="impFile" accept=".json" style="display:none" onchange="importData(event)">
    <button class="btn btn-outline" onclick="window.print()" title="Print">ğŸ–¨ Print</button>
  </div>
  <div class="toolbar-sep"></div>
  <div class="toolbar-group">
    <button class="btn-icon" id="themeBtn" onclick="toggleTheme()" title="Toggle dark mode">ğŸŒ™</button>
    <button class="btn btn-danger" onclick="resetData()" title="Reset to original">â†º Reset</button>
  </div>
  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input type="text" class="search-input" id="searchInput" placeholder="Search subjectâ€¦" oninput="doSearch(this.value)">
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• TIMETABLE â•â•â•â•â•â•â•â•â•â•â• -->
<div class="table-wrapper">
  <table id="tt">
    <thead><tr id="ph"></tr><tr id="th2"></tr></thead>
    <tbody id="tb"></tbody>
  </table>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• BOTTOM CARDS â•â•â•â•â•â•â•â•â•â•â• -->
<div class="cards-row" style="margin-top:20px">

  <!-- Stats Card -->
  <div class="card" style="animation-delay:.05s">
    <div class="card-header">
      <div class="card-title">ğŸ“Š Schedule Overview</div>
    </div>
    <div class="stats-grid" id="statsGrid"></div>
  </div>

  <!-- Legend Card -->
  <div class="card" style="animation-delay:.1s">
    <div class="card-header">
      <div class="card-title">ğŸ“š Subject Legend</div>
      <button class="btn btn-outline" onclick="openLegModal()" style="font-size:.72rem;padding:6px 12px">âœï¸ Edit</button>
    </div>
    <div class="legend-grid" id="legendGrid"></div>
  </div>

</div>

<!-- Period Management Card (full width) -->
<div class="card" style="margin-top:16px;animation-delay:.15s">
  <div class="card-header">
    <div class="card-title">ğŸ• Period Management</div>
  </div>
  <div class="period-list" id="periodList"></div>
  <div class="add-form">
    <div class="ff"><label>Label</label><input id="npN" placeholder="IX"></div>
    <div class="ff"><label>Start Time</label><input id="npS" placeholder="4.25 PM"></div>
    <div class="ff"><label>End Time</label><input id="npE" placeholder="5.10 PM"></div>
    <div class="ff"><label>Insert After</label><select id="npA"><option value="-1">At Beginning</option></select></div>
    <div class="ff" style="flex:0 0 auto;min-width:unset"><label>&nbsp;</label><button class="btn btn-success" onclick="addPeriod()">ï¼‹ Add Period</button></div>
  </div>
</div>

</div><!-- /page-wrap -->

<!-- â•â•â•â•â•â•â•â•â•â•â• SLOT MODAL â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="slotOvl">
  <div class="modal">
    <div class="modal-hdr"><div class="modal-title">Edit Time Slot</div><button class="modal-close" onclick="closeSlotModal()">âœ•</button></div>
    <div class="modal-sub" id="slotSub">â€”</div>
    <div class="mfg"><label>Subject Code</label><input id="inpCode" placeholder="e.g. VEC344" autocomplete="off"></div>
    <div class="mfg"><label>Section / Note</label><input id="inpSec" placeholder="e.g. III ECE A" autocomplete="off"></div>
    <div class="mfg"><label>Quick Fill from Legend</label>
      <select id="quickFill" onchange="applyQuickFill(this.value)">
        <option value="">â€” Pick from legend â€”</option>
      </select>
    </div>
    <div class="mfg"><label>Color Theme</label><div class="color-grid" id="colorGrid"></div></div>
    <div class="modal-acts">
      <button class="btn btn-primary" onclick="saveCell()">ğŸ’¾ Save</button>
      <button class="btn btn-danger" onclick="clearCell()">ğŸ—‘ Clear</button>
      <button class="btn btn-outline" onclick="closeSlotModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• LEGEND MODAL â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="legOvl">
  <div class="modal" style="width:540px">
    <div class="modal-hdr"><div class="modal-title">Edit Subject Legend</div><button class="modal-close" onclick="closeLegModal()">âœ•</button></div>
    <div style="max-height:280px;overflow-y:auto;margin-bottom:14px;display:flex;flex-direction:column;gap:7px" id="legEditList"></div>
    <div style="background:var(--surf);border:1.5px dashed var(--border2);border-radius:12px;padding:14px">
      <div style="font-size:.68rem;font-weight:700;color:var(--text2);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px">Add New Entry</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
        <div class="ff" style="flex:0 0 90px"><label>Code</label><input class="li" id="lnCode" placeholder="VEC344" style="width:100%"></div>
        <div class="ff" style="flex:1;min-width:120px"><label>Description</label><input class="li" id="lnDesc" placeholder="Subject Name" style="width:100%"></div>
        <div class="ff" style="flex:0 0 auto;min-width:unset;align-self:flex-end"><button class="btn btn-success" onclick="addLegEntry()" style="white-space:nowrap;font-size:.76rem">ï¼‹ Add</button></div>
      </div>
      <div style="font-size:.65rem;font-weight:700;color:var(--text2);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px">Color</div>
      <div class="color-grid" id="legColorGrid"></div>
    </div>
    <div class="modal-acts" style="margin-top:14px">
      <button class="btn btn-primary" onclick="saveLegend()">ğŸ’¾ Save Legend</button>
      <button class="btn btn-outline" onclick="closeLegModal()">Cancel</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€ PALETTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const PAL = [
  {bg:'#dbeafe',fg:'#1d4ed8',dk_bg:'#1e3a5f',dk_fg:'#60a5fa',name:'Blue'},
  {bg:'#e0e7ff',fg:'#4338ca',dk_bg:'#1e1b4b',dk_fg:'#818cf8',name:'Indigo'},
  {bg:'#d1fae5',fg:'#065f46',dk_bg:'#022c22',dk_fg:'#34d399',name:'Green'},
  {bg:'#fef3c7',fg:'#92400e',dk_bg:'#451a03',dk_fg:'#fbbf24',name:'Amber'},
  {bg:'#ffe4e6',fg:'#9f1239',dk_bg:'#4c0519',dk_fg:'#fb7185',name:'Rose'},
  {bg:'#ede9fe',fg:'#5b21b6',dk_bg:'#2e1065',dk_fg:'#a78bfa',name:'Violet'},
  {bg:'#ccfbf1',fg:'#134e4a',dk_bg:'#022c22',dk_fg:'#2dd4bf',name:'Teal'},
  {bg:'#ffedd5',fg:'#9a3412',dk_bg:'#431407',dk_fg:'#fb923c',name:'Orange'},
  {bg:'#fce7f3',fg:'#9d174d',dk_bg:'#500724',dk_fg:'#f472b6',name:'Pink'},
  {bg:'#f0fdf4',fg:'#14532d',dk_bg:'#052e16',dk_fg:'#4ade80',name:'Lime'},
  {bg:'#e0f2fe',fg:'#0369a1',dk_bg:'#082f49',dk_fg:'#38bdf8',name:'Sky'},
  {bg:'#fdf4ff',fg:'#6b21a8',dk_bg:'#3b0764',dk_fg:'#c084fc',name:'Purple'},
];

function palBg(c){return isDark?PAL[c%PAL.length].dk_bg:PAL[c%PAL.length].bg}
function palFg(c){return isDark?PAL[c%PAL.length].dk_fg:PAL[c%PAL.length].fg}

/* â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const LS_KEY = 'tt_alwyn_v3';
const DAYS = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const BREAK_AFTER = {1:'Tea Break',3:'Lunch Break',5:'Tea Break'};

const DEF_PERIODS = [
  {id:'I',   s:'9.10 AM',  e:'10.00 AM'},
  {id:'II',  s:'10.00 AM', e:'10.50 AM'},
  {id:'III', s:'11.10 AM', e:'12 NOON'},
  {id:'IV',  s:'12 NOON',  e:'12.50 PM'},
  {id:'V',   s:'1.30 PM',  e:'2.20 PM'},
  {id:'VI',  s:'2.20 PM',  e:'3.00 PM'},
  {id:'VII', s:'3.05 PM',  e:'3.45 PM'},
  {id:'VIII',s:'3.45 PM',  e:'4.25 PM'},
];
const DEF_LEGEND = [
  {code:'VEC344',desc:'Applied Electronics',   c:0},
  {code:'EC2451',desc:'Research Lab',          c:1},
  {code:'EC2257',desc:'Communication Systems', c:2},
  {code:'VEC345',desc:'Digital Systems',       c:3},
  {code:'COUN',  desc:'Counselling',           c:4},
  {code:'TM5',   desc:'Training Module 5',     c:7},
];
const DEF_DATA = {
  Monday:   {1:{code:'VEC344',sec:'III ECE A',c:0}, 6:{code:'VEC344',sec:'III ECE B',c:0}},
  Tuesday:  {2:{code:'VEC344',sec:'III ECE B',c:0}, 4:{code:'VEC345',sec:'III ECE B',c:3}, 6:{code:'VEC344',sec:'III ECE A',c:0}},
  Wednesday:{0:{code:'TM5',sec:'III ECE B',c:7}, 1:{code:'EC2451',sec:'IV ECE (Research Lab)',c:1}, 2:{code:'COUN',sec:'',c:4}, 3:{code:'EC2451',sec:'IV ECE (Research Lab)',c:1}, 5:{code:'EC2257',sec:'II ECE A',c:2}},
  Thursday: {0:{code:'TM5',sec:'III ECE B',c:7}, 2:{code:'VEC344',sec:'III ECE A',c:0}, 4:{code:'VEC345',sec:'III ECE B',c:3}},
  Friday:   {1:{code:'VEC344',sec:'III ECE A',c:0}, 4:{code:'EC2257',sec:'II ECE A',c:2}},
  Saturday: {1:{code:'VEC344',sec:'III ECE A',c:0}, 7:{code:'VEC344',sec:'III ECE B',c:0}},
};

let periods, legend, data;
let editMode = false;
let isDark = false;
let curCell = null;
let selColor = 0;
let legTemp = [], legSelColor = 0;
let unsaved = false;

/* â”€â”€ STORAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function save(){
  try{ localStorage.setItem(LS_KEY, JSON.stringify({periods,legend,data,isDark})); }catch(e){}
  markSaved();
}
function load(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return false;
    const o = JSON.parse(raw);
    if(o.periods) periods = o.periods;
    if(o.legend)  legend  = o.legend;
    if(o.data)    data    = o.data;
    if(o.isDark !== undefined){ isDark = o.isDark; applyTheme(); }
    return true;
  }catch(e){ return false; }
}
function markUnsaved(){unsaved=true;document.getElementById('saveInd').classList.add('show')}
function markSaved(){unsaved=false;document.getElementById('saveInd').classList.remove('show')}

function cp(o){return JSON.parse(JSON.stringify(o))}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

/* â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleTheme(){
  isDark=!isDark; applyTheme(); save();
  document.getElementById('themeBtn').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
}
function applyTheme(){
  document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
  document.getElementById('themeBtn').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
}

/* â”€â”€ BUILD TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildHeaders(){
  const ph=document.getElementById('ph'), th=document.getElementById('th2');
  ph.innerHTML='<th>DAY</th>'; th.innerHTML='<th></th>';
  periods.forEach((p,i)=>{
    const a=document.createElement('th'); a.textContent=p.id; ph.appendChild(a);
    const b=document.createElement('th'); b.textContent=p.s+' â€“ '+p.e; th.appendChild(b);
    if(BREAK_AFTER[i]){
      const c=document.createElement('th'); c.textContent=BREAK_AFTER[i];
      c.style.cssText='color:var(--head-muted);font-size:.57rem;letter-spacing:2px';
      ph.appendChild(c); th.appendChild(document.createElement('th'));
    }
  });
}

function buildBody(){
  const tb=document.getElementById('tb'); tb.innerHTML='';
  const today = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][new Date().getDay()];
  DAYS.forEach(day=>{
    const tr=document.createElement('tr');
    if(day===today) tr.classList.add('today-row');
    const td0=document.createElement('td'); td0.textContent=day.toUpperCase(); tr.appendChild(td0);
    const dd=data[day]||{};
    periods.forEach((p,i)=>{
      const td=document.createElement('td');
      const d=dd[i];
      if(d){
        td.innerHTML=`<div class="cell-inner${editMode?' edit-mode':''}" data-d="${day}" data-i="${i}">
          <div class="subject-pill" style="background:${palBg(d.c)}">
            <div class="subject-code" style="color:${palFg(d.c)}">${esc(d.code)}</div>
            ${d.sec?`<div class="section-label" style="color:${palFg(d.c)}">${esc(d.sec)}</div>`:''}
          </div></div>`;
      } else {
        td.innerHTML=`<div class="cell-inner${editMode?' edit-mode':''}" data-d="${day}" data-i="${i}"><div class="empty-dot"></div></div>`;
      }
      td.querySelector('.cell-inner').onclick=()=>onCell(day,i);
      tr.appendChild(td);
      if(BREAK_AFTER[i]){
        const tb2=document.createElement('td'); tb2.className='break-col';
        tb2.innerHTML=`<div class="break-label">${BREAK_AFTER[i]}</div>`; tr.appendChild(tb2);
      }
    });
    tb.appendChild(tr);
  });
}

function buildPeriodList(){
  const pl=document.getElementById('periodList'); pl.innerHTML='';
  periods.forEach((p,i)=>{
    const t=document.createElement('div'); t.className='period-tag';
    t.innerHTML=`<span class="period-tag-num">${p.id}</span><span>${p.s} â€“ ${p.e}</span><button class="period-tag-del" onclick="removePeriod(${i})" title="Remove">âœ•</button>`;
    pl.appendChild(t);
  });
  const sel=document.getElementById('npA');
  sel.innerHTML='<option value="-1">At Beginning</option>';
  periods.forEach((p,i)=>{const o=document.createElement('option');o.value=i;o.textContent='After Period '+p.id;sel.appendChild(o);});
}

function buildStatsGrid(){
  const totalSlots = DAYS.reduce((acc,day)=>acc+Object.keys(data[day]||{}).length,0);
  const uniqueSubs = new Set(DAYS.flatMap(day=>Object.values(data[day]||{}).map(v=>v.code))).size;
  const busiestDay = DAYS.reduce((a,b)=>Object.keys(data[a]||{}).length>=Object.keys(data[b]||{}).length?a:b,'Monday');
  const g=document.getElementById('statsGrid');
  g.innerHTML=`
    <div class="stat-box"><div class="stat-num">${totalSlots}</div><div class="stat-lbl">Total Classes</div></div>
    <div class="stat-box"><div class="stat-num">${uniqueSubs}</div><div class="stat-lbl">Subjects</div></div>
    <div class="stat-box"><div class="stat-num" style="font-size:1rem;padding-top:4px">${busiestDay.substring(0,3).toUpperCase()}</div><div class="stat-lbl">Busiest Day</div></div>`;
  document.getElementById('statSlots').textContent=totalSlots;
  document.getElementById('statSubjects').textContent=uniqueSubs;
}

function renderLegend(){
  const g=document.getElementById('legendGrid'); g.innerHTML='';
  legend.forEach(item=>{
    const el=document.createElement('div'); el.className='legend-item';
    el.style.borderColor=palFg(item.c)+'44';
    el.innerHTML=`<div class="legend-dot" style="background:${palFg(item.c)}"></div><span class="legend-code" style="color:${palFg(item.c)}">${esc(item.code)}</span><span class="legend-desc">â€” ${esc(item.desc)}</span>`;
    g.appendChild(el);
  });
}

function buildAll(){buildHeaders();buildBody();buildPeriodList();buildStatsGrid();updateBadge();}

/* â”€â”€ EDIT MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleEdit(){
  editMode=!editMode;
  const btn=document.getElementById('editBtn');
  if(editMode){btn.textContent='ğŸ”’ Disable Editing';btn.className='btn btn-amber';}
  else{btn.textContent='âœï¸ Enable Editing';btn.className='btn btn-primary';}
  buildBody();
}

/* â”€â”€ SLOT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onCell(day,i){
  if(!editMode)return;
  curCell={day,i};
  const d=(data[day]||{})[i];
  document.getElementById('slotSub').textContent=`${day} Â· Period ${periods[i]?.id} Â· ${periods[i]?.s} â€“ ${periods[i]?.e}`;
  document.getElementById('inpCode').value=d?d.code:'';
  document.getElementById('inpSec').value=d?d.sec:'';
  selColor=d?d.c:0;
  buildColorGrid('colorGrid',idx=>selColor=idx,selColor);
  // Quick fill dropdown
  const qf=document.getElementById('quickFill');
  qf.innerHTML='<option value="">â€” Pick from legend â€”</option>';
  legend.forEach((l,li)=>{const o=document.createElement('option');o.value=li;o.textContent=l.code+(l.desc?' â€“ '+l.desc:'');qf.appendChild(o);});
  document.getElementById('slotOvl').classList.add('active');
  setTimeout(()=>document.getElementById('inpCode').focus(),50);
}
function applyQuickFill(val){
  if(val==='')return;
  const l=legend[parseInt(val)];
  document.getElementById('inpCode').value=l.code;
  selColor=l.c;
  buildColorGrid('colorGrid',idx=>selColor=idx,selColor);
}
function closeSlotModal(){document.getElementById('slotOvl').classList.remove('active');curCell=null;}
function buildColorGrid(gid,cb,activeIdx){
  const g=document.getElementById(gid); g.innerHTML='';
  PAL.forEach((p,i)=>{
    const c=document.createElement('div');
    c.className='cc'+(i===activeIdx?' on':'');
    c.style.background=`linear-gradient(135deg,${isDark?p.dk_bg:p.bg},${isDark?p.dk_fg:p.fg}33)`;
    c.style.border=`2.5px solid ${isDark?p.dk_fg:p.fg}66`;
    c.title=p.name;
    c.onclick=()=>{
      if(gid==='colorGrid') selColor=i; else legSelColor=i;
      document.querySelectorAll('#'+gid+' .cc').forEach(x=>x.classList.remove('on'));
      c.classList.add('on'); cb(i);
    };
    g.appendChild(c);
  });
}
function saveCell(){
  if(!curCell)return;
  const{day,i}=curCell;
  const code=document.getElementById('inpCode').value.trim();
  const sec=document.getElementById('inpSec').value.trim();
  if(!data[day])data[day]={};
  if(code){data[day][i]={code,sec,c:selColor};}else{delete data[day][i];}
  save(); buildBody(); buildStatsGrid(); renderLegend();
  closeSlotModal(); toast('âœ“ Slot saved','ok');
}
function clearCell(){
  if(!curCell)return;
  if(data[curCell.day])delete data[curCell.day][curCell.i];
  save(); buildBody(); buildStatsGrid();
  closeSlotModal(); toast('Slot cleared','info');
}

/* â”€â”€ LEGEND MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openLegModal(){
  legTemp=cp(legend); legSelColor=0;
  renderLegEdit(); buildColorGrid('legColorGrid',idx=>legSelColor=idx,0);
  document.getElementById('legOvl').classList.add('active');
}
function closeLegModal(){document.getElementById('legOvl').classList.remove('active');}
function renderLegEdit(){
  const list=document.getElementById('legEditList'); list.innerHTML='';
  legTemp.forEach((item,i)=>{
    const row=document.createElement('div'); row.className='leg-row';
    row.innerHTML=`
      <div style="width:11px;height:11px;border-radius:3px;background:${palFg(item.c)};flex-shrink:0"></div>
      <input class="li" value="${esc(item.code)}" style="width:84px" placeholder="Code" oninput="legTemp[${i}].code=this.value">
      <input class="li" value="${esc(item.desc)}" style="flex:1;min-width:90px" placeholder="Description" oninput="legTemp[${i}].desc=this.value">
      <select class="ls" onchange="legTemp[${i}].c=parseInt(this.value);renderLegEdit()">
        ${PAL.map((p,pi)=>`<option value="${pi}"${pi===item.c?' selected':''}>${p.name}</option>`).join('')}
      </select>
      <button onclick="legTemp.splice(${i},1);renderLegEdit()" style="background:var(--rose-lt);border:none;color:var(--rose);border-radius:7px;padding:5px 8px;cursor:pointer;font-weight:700;font-size:.78rem">âœ•</button>`;
    list.appendChild(row);
  });
}
function addLegEntry(){
  const code=document.getElementById('lnCode').value.trim(), desc=document.getElementById('lnDesc').value.trim();
  if(!code){toast('Enter a subject code','err');return;}
  legTemp.push({code,desc:desc||code,c:legSelColor});
  renderLegEdit();
  document.getElementById('lnCode').value='';
  document.getElementById('lnDesc').value='';
}
function saveLegend(){
  legend=cp(legTemp); renderLegend(); save(); closeLegModal(); toast('âœ“ Legend saved','ok');
}

/* â”€â”€ PERIOD MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function addPeriod(){
  const name=document.getElementById('npN').value.trim();
  const s=document.getElementById('npS').value.trim();
  const e=document.getElementById('npE').value.trim();
  const after=parseInt(document.getElementById('npA').value);
  if(!name||!s||!e){toast('Fill Label, Start & End Time','err');return;}
  periods.splice(after+1,0,{id:name,s,e});
  DAYS.forEach(day=>{
    if(!data[day])return;
    const nd={};
    Object.entries(data[day]).forEach(([k,v])=>{const n=parseInt(k);nd[n>=after+1?n+1:n]=v;});
    data[day]=nd;
  });
  ['npN','npS','npE'].forEach(id=>document.getElementById(id).value='');
  save(); buildAll(); toast('âœ“ Period '+name+' added','ok');
}
function removePeriod(idx){
  if(periods.length<=1){toast('Cannot remove last period','err');return;}
  if(!confirm(`Remove Period ${periods[idx].id} (${periods[idx].s} â€“ ${periods[idx].e})?\nAll slots in this period will be cleared.`))return;
  periods.splice(idx,1);
  DAYS.forEach(day=>{
    if(!data[day])return;
    const nd={};
    Object.entries(data[day]).forEach(([k,v])=>{const n=parseInt(k);if(n===idx)return;nd[n>idx?n-1:n]=v;});
    data[day]=nd;
  });
  save(); buildAll(); toast('Period removed','info');
}

/* â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function doSearch(q){
  document.querySelectorAll('.cell-inner').forEach(c=>{
    c.classList.remove('search-hl');
    const pill=c.querySelector('.subject-code');
    if(!pill)return;
    if(q.trim()&&pill.textContent.toLowerCase().includes(q.toLowerCase().trim())){
      c.classList.add('search-hl');
    }
  });
}

/* â”€â”€ IMPORT / EXPORT / RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function exportData(){
  const blob=new Blob([JSON.stringify({periods,legend,data},null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob),a=document.createElement('a');
  a.href=url;a.download='timetable_alwyn_rajiv.json';a.click();URL.revokeObjectURL(url);
  toast('âœ“ Exported successfully','ok');
}
function importData(e){
  const file=e.target.files[0];if(!file)return;
  const r=new FileReader();
  r.onload=ev=>{
    try{
      const o=JSON.parse(ev.target.result);
      if(o.periods)periods=o.periods;
      if(o.legend)legend=o.legend;
      if(o.data)data=o.data;
      save(); buildAll(); renderLegend(); toast('âœ“ Imported successfully','ok');
    }catch{toast('âš  Invalid JSON file','err');}
  };
  r.readAsText(file); e.target.value='';
}
function resetData(){
  if(!confirm('Reset everything to the original timetable?\nAll your edits will be lost.'))return;
  periods=cp(DEF_PERIODS); legend=cp(DEF_LEGEND); data=cp(DEF_DATA);
  save(); buildAll(); renderLegend(); toast('â†º Reset to original','info');
}

/* â”€â”€ UTILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let toastTimer;
function toast(msg,type='ok'){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className='toast '+type+' show';
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'),3000);
}
function updateBadge(){
  const d=new Date();
  const ns=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  document.getElementById('dayBadge').textContent=ns[d.getDay()]+' Â· '+d.toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
}

// Close overlays on outside click
['slotOvl','legOvl'].forEach(id=>{
  document.getElementById(id).onclick=e=>{if(e.target===document.getElementById(id)){if(id==='slotOvl')closeSlotModal();else closeLegModal();}};
});

// Keyboard shortcuts
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){closeSlotModal();closeLegModal();}
  if(e.key==='e'&&(e.ctrlKey||e.metaKey)){e.preventDefault();toggleEdit();}
});

/* â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function init(){
  periods=cp(DEF_PERIODS); legend=cp(DEF_LEGEND); data=cp(DEF_DATA);
  const restored = load(); // load from localStorage â€” overwrites defaults if saved data exists
  buildAll();
  renderLegend();
  if(restored) toast('ğŸ“‚ Your saved timetable loaded','info');
})();
</script>
</body>
</html>